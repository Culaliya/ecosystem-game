<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç”Ÿæ…‹ç³»çµ±æ¢éšªå®¶ - é€²éšç‰ˆ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .game-container {
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            max-width: 900px;
            width: 95%;
            overflow: hidden;
        }

        .game-header {
            background: linear-gradient(135deg, #4CAF50, #45a049);
            color: white;
            padding: 20px;
            text-align: center;
        }

        .game-header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .stats {
            display: flex;
            justify-content: space-around;
            margin: 10px 0;
            font-size: 1.1rem;
        }

        .stat-item {
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .game-modes {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin: 15px 0;
        }

        .mode-btn {
            background: rgba(255,255,255,0.2);
            color: white;
            border: 2px solid rgba(255,255,255,0.3);
            padding: 10px 20px;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .mode-btn.active {
            background: white;
            color: #4CAF50;
            border-color: white;
        }

        .game-area {
            padding: 30px;
            min-height: 400px;
        }

        .environment-selector {
            display: flex;
            gap: 10px;
            margin-bottom: 30px;
            flex-wrap: wrap;
            justify-content: center;
        }

        .env-button {
            background: linear-gradient(135deg, #FF6B6B, #FF8E8E);
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 50px;
            font-size: 0.9rem;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 5px 15px rgba(255,107,107,0.3);
        }

        .env-button:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(255,107,107,0.4);
        }

        .env-button.active {
            background: linear-gradient(135deg, #4CAF50, #45a049);
            box-shadow: 0 5px 15px rgba(76,175,80,0.3);
        }

        .exploration-area {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 20px;
            border: 3px solid #e9ecef;
        }

        .creature-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .creature-card {
            background: white;
            border-radius: 10px;
            padding: 15px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid #e9ecef;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            position: relative;
        }

        .creature-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 20px rgba(0,0,0,0.15);
            border-color: #4CAF50;
        }

        .creature-card.discovered {
            background: linear-gradient(135deg, #e8f5e8, #f0f8f0);
            border-color: #4CAF50;
        }

        .creature-card.locked {
            opacity: 0.5;
            cursor: not-allowed;
            background: #f5f5f5;
        }

        .creature-card.locked:hover {
            transform: none;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            border-color: #e9ecef;
        }

        .lock-icon {
            position: absolute;
            top: 5px;
            right: 5px;
            font-size: 1.2rem;
        }

        .creature-emoji {
            font-size: 2.5rem;
            margin-bottom: 8px;
            display: block;
        }

        .creature-name {
            font-weight: bold;
            color: #333;
            margin-bottom: 5px;
        }

        .creature-role {
            font-size: 0.8rem;
            color: #666;
        }

        .question-panel {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 25px;
            border-radius: 15px;
            margin-top: 20px;
            display: none;
        }

        .question-panel.active {
            display: block;
            animation: slideIn 0.5s ease;
        }

        @keyframes slideIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .question-title {
            font-size: 1.3rem;
            margin-bottom: 15px;
            text-align: center;
        }

        .answers {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-top: 20px;
        }

        .answer-btn {
            background: rgba(255,255,255,0.2);
            color: white;
            border: 2px solid rgba(255,255,255,0.3);
            padding: 15px;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 1rem;
        }

        .answer-btn:hover {
            background: rgba(255,255,255,0.3);
            transform: translateY(-2px);
        }

        .answer-btn.correct {
            background: #4CAF50;
            border-color: #45a049;
        }

        .answer-btn.wrong {
            background: #f44336;
            border-color: #d32f2f;
        }

        .feedback {
            margin-top: 20px;
            padding: 15px;
            border-radius: 10px;
            background: rgba(255,255,255,0.1);
            text-align: center;
        }

        /* é£Ÿç‰©éˆé€£ç·šéŠæˆ² */
        .food-chain-game {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 25px;
            margin-top: 20px;
            display: none;
        }

        .food-chain-game.active {
            display: block;
        }

        .chain-level {
            display: flex;
            justify-content: space-around;
            margin: 20px 0;
            align-items: center;
        }

        .chain-item {
            background: white;
            border-radius: 10px;
            padding: 15px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid #e9ecef;
            min-width: 120px;
        }

        .chain-item:hover {
            transform: scale(1.05);
            border-color: #4CAF50;
        }

        .chain-item.selected {
            background: #4CAF50;
            color: white;
            border-color: #45a049;
        }

        .chain-item.correct {
            background: #4CAF50;
            color: white;
            animation: pulse 1s;
        }

        .chain-item.wrong {
            background: #f44336;
            color: white;
            animation: shake 0.5s;
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }

        .chain-arrow {
            font-size: 2rem;
            color: #666;
        }

        /* å¯¦é©—æ¨¡æ“¬ */
        .experiment-lab {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 25px;
            margin-top: 20px;
            display: none;
        }

        .experiment-lab.active {
            display: block;
        }

        .experiment-controls {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
            flex-wrap: wrap;
            justify-content: center;
        }

        .control-btn {
            background: #2196F3;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .control-btn:hover {
            background: #1976D2;
            transform: translateY(-2px);
        }

        .experiment-display {
            background: white;
            border-radius: 10px;
            padding: 20px;
            margin-top: 20px;
            border: 2px solid #e9ecef;
            min-height: 200px;
        }

        .population-graph {
            display: flex;
            align-items: end;
            justify-content: space-around;
            height: 150px;
            margin-top: 20px;
        }

        .population-bar {
            width: 30px;
            background: #4CAF50;
            border-radius: 5px 5px 0 0;
            transition: height 0.5s ease;
            position: relative;
        }

        .population-bar.predator {
            background: #FF6B6B;
        }

        .population-bar.prey {
            background: #4CAF50;
        }

        .bar-label {
            position: absolute;
            bottom: -25px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 0.8rem;
            white-space: nowrap;
        }

        .achievement {
            background: linear-gradient(135deg, #FFD700, #FFA500);
            color: #333;
            padding: 15px;
            border-radius: 10px;
            margin-top: 15px;
            text-align: center;
            font-weight: bold;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        .progress-bar {
            background: #e0e0e0;
            border-radius: 10px;
            height: 10px;
            margin: 10px 0;
            overflow: hidden;
        }

        .progress-fill {
            background: linear-gradient(90deg, #4CAF50, #8BC34A);
            height: 100%;
            transition: width 0.5s ease;
            border-radius: 10px;
        }

        .hidden {
            display: none;
        }

        /* éŸ³æ•ˆæ§åˆ¶ */
        .audio-controls {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1000;
            display: flex;
            gap: 10px;
        }

        .audio-btn {
            background: rgba(255,255,255,0.9);
            border: none;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            cursor: pointer;
            font-size: 1.2rem;
            transition: all 0.3s ease;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }

        .audio-btn:hover {
            background: white;
            transform: scale(1.1);
        }

        .audio-btn.muted {
            background: rgba(255,100,100,0.9);
        }

        @media (max-width: 600px) {
            .game-header h1 {
                font-size: 2rem;
            }
            
            .stats {
                flex-direction: column;
                gap: 10px;
            }
            
            .answers {
                grid-template-columns: 1fr;
            }

            .environment-selector {
                grid-template-columns: 1fr 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="game-container">
        <!-- éŸ³æ•ˆæ§åˆ¶ -->
        <div class="audio-controls">
            <button class="audio-btn" id="music-btn" onclick="toggleMusic()" title="èƒŒæ™¯éŸ³æ¨‚">ğŸµ</button>
            <button class="audio-btn" id="sound-btn" onclick="toggleSound()" title="éŸ³æ•ˆ">ğŸ”Š</button>
        </div>
        
        <div class="game-header">
            <h1>ğŸŒ ç”Ÿæ…‹ç³»çµ±æ¢éšªå®¶</h1>
            <p>æ¢ç´¢å¤§è‡ªç„¶çš„å¥§ç§˜ï¼Œç™¼ç¾ç”Ÿç‰©ä¹‹é–“çš„é—œä¿‚ï¼</p>
            
            <div class="game-modes">
                <button class="mode-btn active" onclick="switchMode('explore')">ğŸ” æ¢ç´¢æ¨¡å¼</button>
                <button class="mode-btn" onclick="switchMode('foodchain')">ğŸ”— é£Ÿç‰©éˆ</button>
                <button class="mode-btn" onclick="switchMode('experiment')">ğŸ§ª å¯¦é©—å®¤</button>
            </div>
            
            <div class="stats">
                <div class="stat-item">
                    <span>ğŸ” å·²ç™¼ç¾ï¼š</span>
                    <span id="discovered-count">0</span>
                </div>
                <div class="stat-item">
                    <span>â­ åˆ†æ•¸ï¼š</span>
                    <span id="score">0</span>
                </div>
                <div class="stat-item">
                    <span>ğŸ† ç­‰ç´šï¼š</span>
                    <span id="level">æ–°æ‰‹æ¢éšªå®¶</span>
                </div>
            </div>
            <div class="progress-bar">
                <div class="progress-fill" id="progress-fill" style="width: 0%"></div>
            </div>
        </div>

        <div class="game-area">
            <!-- æ¢ç´¢æ¨¡å¼ -->
            <div id="explore-mode" class="game-mode active">
                <div class="environment-selector">
                    <button class="env-button active" onclick="selectEnvironment('forest')">ğŸŒ² æ£®æ—</button>
                    <button class="env-button" onclick="selectEnvironment('ocean')">ğŸŒŠ æµ·æ´‹</button>
                    <button class="env-button" onclick="selectEnvironment('grassland')">ğŸŒ¾ è‰åŸ</button>
                    <button class="env-button" onclick="selectEnvironment('desert')">ğŸœï¸ æ²™æ¼ </button>
                    <button class="env-button" onclick="selectEnvironment('arctic')">ğŸ§Š æ¥µåœ°</button>
                    <button class="env-button" onclick="selectEnvironment('rainforest')">ğŸŒ´ ç†±å¸¶é›¨æ—</button>
                    <button class="env-button" onclick="selectEnvironment('wetland')">ğŸ¦† æ¿•åœ°</button>
                    <button class="env-button" onclick="selectEnvironment('mountain')">â›°ï¸ é«˜å±±</button>
                </div>

                <div class="exploration-area">
                    <h3>ğŸ” æ¢ç´¢ <span id="current-env">æ£®æ—</span> ç”Ÿæ…‹ç³»çµ±</h3>
                    <p>é»æ“Šç”Ÿç‰©ä¾†äº†è§£å®ƒå€‘åœ¨ç”Ÿæ…‹ç³»çµ±ä¸­çš„è§’è‰²ï¼å¿…é ˆå›ç­”å•é¡Œæ‰èƒ½ç¹¼çºŒæ¢ç´¢ã€‚</p>
                    <div class="creature-grid" id="creature-grid">
                        <!-- ç”Ÿç‰©å¡ç‰‡æœƒåœ¨é€™è£¡å‹•æ…‹ç”Ÿæˆ -->
                    </div>
                </div>

                <div class="question-panel" id="question-panel">
                    <div class="question-title" id="question-title"></div>
                    <div id="question-content"></div>
                    <div class="answers" id="answers"></div>
                    <div class="feedback" id="feedback"></div>
                </div>
            </div>

            <!-- é£Ÿç‰©éˆé€£ç·šéŠæˆ² -->
            <div id="foodchain-mode" class="game-mode food-chain-game">
                <h3>ğŸ”— å»ºç«‹é£Ÿç‰©éˆ</h3>
                <p>é»æ“Šç”Ÿç‰©ä¾†å»ºç«‹æ­£ç¢ºçš„é£Ÿç‰©éˆé †åºï¼</p>
                
                <div class="chain-level">
                    <div class="chain-item" data-level="1">
                        <div class="creature-emoji">ğŸŒ±</div>
                        <div>ç”Ÿç”¢è€…</div>
                    </div>
                    <div class="chain-arrow">â†’</div>
                    <div class="chain-item" data-level="2" id="chain-slot-2">
                        <div>é»æ“Šé¸æ“‡</div>
                    </div>
                    <div class="chain-arrow">â†’</div>
                    <div class="chain-item" data-level="3" id="chain-slot-3">
                        <div>é»æ“Šé¸æ“‡</div>
                    </div>
                    <div class="chain-arrow">â†’</div>
                    <div class="chain-item" data-level="4" id="chain-slot-4">
                        <div>é»æ“Šé¸æ“‡</div>
                    </div>
                </div>

                <div class="chain-options" id="chain-options">
                    <!-- é¸é …æœƒå‹•æ…‹ç”Ÿæˆ -->
                </div>

                <div style="text-align: center; margin-top: 20px;">
                    <button class="control-btn" onclick="checkFoodChain()">ğŸ” æª¢æŸ¥ç­”æ¡ˆ</button>
                    <button class="control-btn" onclick="resetFoodChain()">ğŸ”„ é‡æ–°é–‹å§‹</button>
                </div>
            </div>

            <!-- å¯¦é©—æ¨¡æ“¬ -->
            <div id="experiment-mode" class="game-mode experiment-lab">
                <h3>ğŸ§ª ç”Ÿæ…‹ç³»çµ±å¯¦é©—å®¤</h3>
                <p>èª¿æ•´ç’°å¢ƒæ¢ä»¶ï¼Œè§€å¯Ÿç”Ÿç‰©æ•¸é‡çš„è®ŠåŒ–ï¼</p>
                
                <div class="experiment-controls">
                    <button class="control-btn" onclick="adjustEnvironment('temperature', 1)">ğŸŒ¡ï¸ å‡æº«</button>
                    <button class="control-btn" onclick="adjustEnvironment('temperature', -1)">â„ï¸ é™æº«</button>
                    <button class="control-btn" onclick="adjustEnvironment('rainfall', 1)">ğŸŒ§ï¸ å¢é›¨</button>
                    <button class="control-btn" onclick="adjustEnvironment('rainfall', -1)">â˜€ï¸ æ¸›é›¨</button>
                    <button class="control-btn" onclick="adjustEnvironment('pollution', 1)">ğŸ­ æ±¡æŸ“</button>
                    <button class="control-btn" onclick="adjustEnvironment('pollution', -1)">ğŸŒ± æ·¨åŒ–</button>
                    <button class="control-btn" onclick="resetExperiment()">ğŸ”„ é‡ç½®</button>
                </div>

                <div class="experiment-display">
                    <h4>ç’°å¢ƒç‹€æ…‹ï¼š</h4>
                    <div id="environment-status">
                        <p>ğŸŒ¡ï¸ æº«åº¦ï¼š<span id="temperature">é©ä¸­</span></p>
                        <p>ğŸŒ§ï¸ é™é›¨ï¼š<span id="rainfall">é©ä¸­</span></p>
                        <p>ğŸ­ æ±¡æŸ“ï¼š<span id="pollution">ä½</span></p>
                    </div>
                    
                    <div class="population-graph" id="population-graph">
                        <div class="population-bar prey" id="plant-bar" style="height: 60px;">
                            <div class="bar-label">ğŸŒ± æ¤ç‰©</div>
                        </div>
                        <div class="population-bar prey" id="herbivore-bar" style="height: 40px;">
                            <div class="bar-label">ğŸ° è‰é£Ÿå‹•ç‰©</div>
                        </div>
                        <div class="population-bar predator" id="carnivore-bar" style="height: 30px;">
                            <div class="bar-label">ğŸ¦Š è‚‰é£Ÿå‹•ç‰©</div>
                        </div>
                    </div>
                </div>
            </div>

            <div id="achievement" class="achievement hidden">
                ğŸ‰ å¤ªæ£’äº†ï¼ä½ ç²å¾—äº†æ–°æˆå°±ï¼
            </div>
        </div>
    </div>

    <script>
        // æ“´å±•çš„éŠæˆ²æ•¸æ“š
        const gameData = {
            forest: {
                name: 'æ£®æ—',
                creatures: [
                    { id: 'tree', emoji: 'ğŸŒ³', name: 'å¤§æ¨¹', role: 'ç”Ÿç”¢è€…', discovered: false, questions: 'producer' },
                    { id: 'rabbit', emoji: 'ğŸ°', name: 'å…”å­', role: 'è‰é£Ÿå‹•ç‰©', discovered: false, questions: 'herbivore' },
                    { id: 'fox', emoji: 'ğŸ¦Š', name: 'ç‹ç‹¸', role: 'è‚‰é£Ÿå‹•ç‰©', discovered: false, questions: 'carnivore' },
                    { id: 'bird', emoji: 'ğŸ¦', name: 'é³¥é¡', role: 'é›œé£Ÿå‹•ç‰©', discovered: false, questions: 'omnivore' },
                    { id: 'mushroom', emoji: 'ğŸ„', name: 'è˜‘è‡', role: 'åˆ†è§£è€…', discovered: false, questions: 'decomposer' },
                    { id: 'squirrel', emoji: 'ğŸ¿ï¸', name: 'æ¾é¼ ', role: 'è‰é£Ÿå‹•ç‰©', discovered: false, questions: 'herbivore' }
                ]
            },
            ocean: {
                name: 'æµ·æ´‹',
                creatures: [
                    { id: 'seaweed', emoji: 'ğŸŒ¿', name: 'æµ·è‰', role: 'ç”Ÿç”¢è€…', discovered: false, questions: 'producer' },
                    { id: 'fish', emoji: 'ğŸŸ', name: 'å°é­š', role: 'è‰é£Ÿå‹•ç‰©', discovered: false, questions: 'herbivore' },
                    { id: 'shark', emoji: 'ğŸ¦ˆ', name: 'é¯Šé­š', role: 'è‚‰é£Ÿå‹•ç‰©', discovered: false, questions: 'carnivore' },
                    { id: 'whale', emoji: 'ğŸ‹', name: 'é¯¨é­š', role: 'è‚‰é£Ÿå‹•ç‰©', discovered: false, questions: 'carnivore' },
                    { id: 'crab', emoji: 'ğŸ¦€', name: 'èƒèŸ¹', role: 'é›œé£Ÿå‹•ç‰©', discovered: false, questions: 'omnivore' },
                    { id: 'jellyfish', emoji: 'ğŸª¼', name: 'æ°´æ¯', role: 'è‚‰é£Ÿå‹•ç‰©', discovered: false, questions: 'carnivore' }
                ]
            },
            grassland: {
                name: 'è‰åŸ',
                creatures: [
                    { id: 'grass', emoji: 'ğŸŒ±', name: 'è‰', role: 'ç”Ÿç”¢è€…', discovered: false, questions: 'producer' },
                    { id: 'zebra', emoji: 'ğŸ¦“', name: 'æ–‘é¦¬', role: 'è‰é£Ÿå‹•ç‰©', discovered: false, questions: 'herbivore' },
                    { id: 'lion', emoji: 'ğŸ¦', name: 'ç…å­', role: 'è‚‰é£Ÿå‹•ç‰©', discovered: false, questions: 'carnivore' },
                    { id: 'elephant', emoji: 'ğŸ˜', name: 'å¤§è±¡', role: 'è‰é£Ÿå‹•ç‰©', discovered: false, questions: 'herbivore' },
                    { id: 'eagle', emoji: 'ğŸ¦…', name: 'è€é·¹', role: 'è‚‰é£Ÿå‹•ç‰©', discovered: false, questions: 'carnivore' },
                    { id: 'antelope', emoji: 'ğŸ¦Œ', name: 'ç¾šç¾Š', role: 'è‰é£Ÿå‹•ç‰©', discovered: false, questions: 'herbivore' }
                ]
            },
            desert: {
                name: 'æ²™æ¼ ',
                creatures: [
                    { id: 'cactus', emoji: 'ğŸŒµ', name: 'ä»™äººæŒ', role: 'ç”Ÿç”¢è€…', discovered: false, questions: 'producer' },
                    { id: 'camel', emoji: 'ğŸª', name: 'é§±é§', role: 'è‰é£Ÿå‹•ç‰©', discovered: false, questions: 'herbivore' },
                    { id: 'snake', emoji: 'ğŸ', name: 'è›‡', role: 'è‚‰é£Ÿå‹•ç‰©', discovered: false, questions: 'carnivore' },
                    { id: 'lizard', emoji: 'ğŸ¦', name: 'èœ¥èœ´', role: 'é›œé£Ÿå‹•ç‰©', discovered: false, questions: 'omnivore' },
                    { id: 'scorpion', emoji: 'ğŸ¦‚', name: 'è å­', role: 'è‚‰é£Ÿå‹•ç‰©', discovered: false, questions: 'carnivore' },
                    { id: 'beetle', emoji: 'ğŸª²', name: 'ç”²èŸ²', role: 'åˆ†è§£è€…', discovered: false, questions: 'decomposer' }
                ]
            },
            arctic: {
                name: 'æ¥µåœ°',
                creatures: [
                    { id: 'algae', emoji: 'ğŸŸ¢', name: 'è—»é¡', role: 'ç”Ÿç”¢è€…', discovered: false, questions: 'producer' },
                    { id: 'seal', emoji: 'ğŸ¦­', name: 'æµ·è±¹', role: 'è‚‰é£Ÿå‹•ç‰©', discovered: false, questions: 'carnivore' },
                    { id: 'polarbear', emoji: 'ğŸ»â€â„ï¸', name: 'åŒ—æ¥µç†Š', role: 'è‚‰é£Ÿå‹•ç‰©', discovered: false, questions: 'carnivore' },
                    { id: 'penguin', emoji: 'ğŸ§', name: 'ä¼éµ', role: 'è‚‰é£Ÿå‹•ç‰©', discovered: false, questions: 'carnivore' },
                    { id: 'walrus', emoji: 'ğŸ¦­', name: 'æµ·è±¡', role: 'è‚‰é£Ÿå‹•ç‰©', discovered: false, questions: 'carnivore' },
                    { id: 'arctic_fox', emoji: 'ğŸ¦Š', name: 'åŒ—æ¥µç‹', role: 'é›œé£Ÿå‹•ç‰©', discovered: false, questions: 'omnivore' }
                ]
            },
            rainforest: {
                name: 'ç†±å¸¶é›¨æ—',
                creatures: [
                    { id: 'tropical_tree', emoji: 'ğŸŒ´', name: 'ç†±å¸¶æ¨¹æœ¨', role: 'ç”Ÿç”¢è€…', discovered: false, questions: 'producer' },
                    { id: 'monkey', emoji: 'ğŸ’', name: 'çŒ´å­', role: 'é›œé£Ÿå‹•ç‰©', discovered: false, questions: 'omnivore' },
                    { id: 'parrot', emoji: 'ğŸ¦œ', name: 'é¸šéµ¡', role: 'é›œé£Ÿå‹•ç‰©', discovered: false, questions: 'omnivore' },
                    { id: 'jaguar', emoji: 'ğŸ†', name: 'ç¾æ´²è±¹', role: 'è‚‰é£Ÿå‹•ç‰©', discovered: false, questions: 'carnivore' },
                    { id: 'toucan', emoji: 'ğŸ¦ƒ', name: 'å·¨å˜´é³¥', role: 'é›œé£Ÿå‹•ç‰©', discovered: false, questions: 'omnivore' },
                    { id: 'sloth', emoji: 'ğŸ¦¥', name: 'æ¨¹æ‡¶', role: 'è‰é£Ÿå‹•ç‰©', discovered: false, questions: 'herbivore' }
                ]
            },
            wetland: {
                name: 'æ¿•åœ°',
                creatures: [
                    { id: 'reed', emoji: 'ğŸŒ¾', name: 'è˜†è‘¦', role: 'ç”Ÿç”¢è€…', discovered: false, questions: 'producer' },
                    { id: 'duck', emoji: 'ğŸ¦†', name: 'é´¨å­', role: 'é›œé£Ÿå‹•ç‰©', discovered: false, questions: 'omnivore' },
                    { id: 'heron', emoji: 'ğŸ¦¢', name: 'é·ºé·¥', role: 'è‚‰é£Ÿå‹•ç‰©', discovered: false, questions: 'carnivore' },
                    { id: 'frog', emoji: 'ğŸ¸', name: 'é’è›™', role: 'è‚‰é£Ÿå‹•ç‰©', discovered: false, questions: 'carnivore' },
                    { id: 'beaver', emoji: 'ğŸ¦«', name: 'æµ·ç‹¸', role: 'è‰é£Ÿå‹•ç‰©', discovered: false, questions: 'herbivore' },
                    { id: 'dragonfly', emoji: 'ğŸ¦‹', name: 'èœ»èœ“', role: 'è‚‰é£Ÿå‹•ç‰©', discovered: false, questions: 'carnivore' }
                ]
            },
            mountain: {
                name: 'é«˜å±±',
                creatures: [
                    { id: 'pine', emoji: 'ğŸŒ²', name: 'æ¾æ¨¹', role: 'ç”Ÿç”¢è€…', discovered: false, questions: 'producer' },
                    { id: 'mountain_goat', emoji: 'ğŸ', name: 'å±±ç¾Š', role: 'è‰é£Ÿå‹•ç‰©', discovered: false, questions: 'herbivore' },
                    { id: 'snow_leopard', emoji: 'ğŸ†', name: 'é›ªè±¹', role: 'è‚‰é£Ÿå‹•ç‰©', discovered: false, questions: 'carnivore' },
                    { id: 'eagle_mountain', emoji: 'ğŸ¦…', name: 'å±±é·¹', role: 'è‚‰é£Ÿå‹•ç‰©', discovered: false, questions: 'carnivore' },
                    { id: 'marmot', emoji: 'ğŸ¦«', name: 'æ—±çº', role: 'è‰é£Ÿå‹•ç‰©', discovered: false, questions: 'herbivore' },
                    { id: 'yak', emoji: 'ğŸ‚', name: 'æ°‚ç‰›', role: 'è‰é£Ÿå‹•ç‰©', discovered: false, questions: 'herbivore' }
                ]
            }
        };

        // æ“´å±•çš„å•é¡Œåº«
        const questions = {
            producer: [
                {
                    question: "ç”Ÿç”¢è€…åœ¨ç”Ÿæ…‹ç³»çµ±ä¸­çš„ä¸»è¦ä½œç”¨æ˜¯ä»€éº¼ï¼Ÿ",
                    answers: ["è£½é€ æ°§æ°£å’Œæœ‰æ©Ÿç‰©", "åˆ†è§£æ­»äº¡çš„ç”Ÿç‰©", "æ§åˆ¶å…¶ä»–ç”Ÿç‰©æ•¸é‡", "ä¿è­·ç’°å¢ƒä¸å—æ±¡æŸ“"],
                    correct: 0,
                    explanation: "ç”Ÿç”¢è€…ï¼ˆå¦‚æ¤ç‰©ï¼‰é€éå…‰åˆä½œç”¨è£½é€ æ°§æ°£å’Œæœ‰æ©Ÿç‰©ï¼Œæ˜¯ç”Ÿæ…‹ç³»çµ±èƒ½é‡çš„ä¸»è¦ä¾†æºï¼"
                },
                {
                    question: "æ¤ç‰©é€²è¡Œå…‰åˆä½œç”¨éœ€è¦å“ªäº›æ¢ä»¶ï¼Ÿ",
                    answers: ["é™½å…‰ã€æ°´ã€äºŒæ°§åŒ–ç¢³", "æ°§æ°£ã€æ°´ã€é¤Šåˆ†", "æº«åº¦ã€æ¿•åº¦ã€åœŸå£¤", "é™½å…‰ã€æ°§æ°£ã€æ°®æ°£"],
                    correct: 0,
                    explanation: "æ¤ç‰©éœ€è¦é™½å…‰ã€æ°´å’ŒäºŒæ°§åŒ–ç¢³ä¾†é€²è¡Œå…‰åˆä½œç”¨ï¼Œè£½é€ è‘¡è„ç³–å’Œæ°§æ°£ã€‚"
                }
            ],
            herbivore: [
                {
                    question: "è‰é£Ÿå‹•ç‰©åœ¨é£Ÿç‰©éˆä¸­æ‰®æ¼”ä»€éº¼è§’è‰²ï¼Ÿ",
                    answers: ["é ‚ç´šæ é£Ÿè€…", "åˆç´šæ¶ˆè²»è€…", "åˆ†è§£è€…", "ç”Ÿç”¢è€…"],
                    correct: 1,
                    explanation: "è‰é£Ÿå‹•ç‰©æ˜¯åˆç´šæ¶ˆè²»è€…ï¼Œå®ƒå€‘ç›´æ¥é£Ÿç”¨æ¤ç‰©ï¼Œå°‡æ¤ç‰©çš„èƒ½é‡è½‰æ›ä¸¦å‚³éçµ¦å…¶ä»–å‹•ç‰©ã€‚"
                },
                {
                    question: "ç‚ºä»€éº¼è‰é£Ÿå‹•ç‰©é€šå¸¸éœ€è¦èŠ±å¾ˆå¤šæ™‚é–“é€²é£Ÿï¼Ÿ",
                    answers: ["æ¤ç‰©ç‡Ÿé¤Šå¯†åº¦ä½", "ç‰™é½’ä¸å¤ é‹’åˆ©", "æ¶ˆåŒ–é€Ÿåº¦æ…¢", "é£Ÿç‰©ç¨€å°‘"],
                    correct: 0,
                    explanation: "æ¤ç‰©çš„ç‡Ÿé¤Šå¯†åº¦æ¯”è‚‰é¡ä½ï¼Œè‰é£Ÿå‹•ç‰©éœ€è¦åƒå¤§é‡æ¤ç‰©æ‰èƒ½ç²å¾—è¶³å¤ çš„ç‡Ÿé¤Šã€‚"
                }
            ],
            carnivore: [
                {
                    question: "è‚‰é£Ÿå‹•ç‰©å°ç”Ÿæ…‹ç³»çµ±æœ‰ä»€éº¼é‡è¦å½±éŸ¿ï¼Ÿ",
                    answers: ["å¢åŠ æ¤ç‰©æ•¸é‡", "æ§åˆ¶è‰é£Ÿå‹•ç‰©æ•¸é‡", "è£½é€ æ°§æ°£", "åˆ†è§£æœ‰æ©Ÿç‰©"],
                    correct: 1,
                    explanation: "è‚‰é£Ÿå‹•ç‰©æ˜¯é‡è¦çš„æ§åˆ¶è€…ï¼Œå®ƒå€‘çµé£Ÿå…¶ä»–å‹•ç‰©ï¼Œç¶­æŒç”Ÿæ…‹ç³»çµ±çš„å¹³è¡¡ã€‚"
                },
                {
                    question: "è‚‰é£Ÿå‹•ç‰©çš„ç‰™é½’é€šå¸¸æœ‰ä»€éº¼ç‰¹å¾µï¼Ÿ",
                    answers: ["å¹³å¦é©åˆç£¨ç¢", "å°–éŠ³é©åˆæ’•å’¬", "å¾ˆå°ä¸æ˜é¡¯", "æ²’æœ‰ç‰¹æ®Šå½¢ç‹€"],
                    correct: 1,
                    explanation: "è‚‰é£Ÿå‹•ç‰©æœ‰å°–éŠ³çš„çŠ¬é½’å’Œé–€é½’ï¼Œé©åˆæ’•å’¬å’Œåˆ‡å‰²è‚‰é¡ã€‚"
                }
            ],
            omnivore: [
                {
                    question: "é›œé£Ÿå‹•ç‰©çš„ç”Ÿå­˜å„ªå‹¢æ˜¯ä»€éº¼ï¼Ÿ",
                    answers: ["é£Ÿç‰©ä¾†æºå¤šæ¨£åŒ–", "æ¶ˆåŒ–èƒ½åŠ›æœ€å¼·", "èº«é«”æœ€å¤§", "é€Ÿåº¦æœ€å¿«"],
                    correct: 0,
                    explanation: "é›œé£Ÿå‹•ç‰©æ—¢åƒæ¤ç‰©åˆåƒå‹•ç‰©ï¼Œé£Ÿç‰©ä¾†æºå¤šæ¨£åŒ–ï¼Œèƒ½é©æ‡‰ä¸åŒç’°å¢ƒè®ŠåŒ–ã€‚"
                },
                {
                    question: "äººé¡å±¬æ–¼å“ªç¨®é¡å‹çš„æ¶ˆè²»è€…ï¼Ÿ",
                    answers: ["è‰é£Ÿå‹•ç‰©", "è‚‰é£Ÿå‹•ç‰©", "é›œé£Ÿå‹•ç‰©", "åˆ†è§£è€…"],
                    correct: 2,
                    explanation: "äººé¡æ˜¯é›œé£Ÿå‹•ç‰©ï¼Œæ—¢åƒæ¤ç‰©ä¹Ÿåƒå‹•ç‰©ï¼Œç‰™é½’çµæ§‹ä¹Ÿé©åˆè™•ç†å¤šç¨®é£Ÿç‰©ã€‚"
                }
            ],
            decomposer: [
                {
                    question: "åˆ†è§£è€…åœ¨ç”Ÿæ…‹ç³»çµ±ä¸­çš„åŠŸèƒ½æ˜¯ä»€éº¼ï¼Ÿ",
                    answers: ["è£½é€ é£Ÿç‰©", "çµé£Ÿå…¶ä»–ç”Ÿç‰©", "åˆ†è§£æ­»äº¡ç”Ÿç‰©ä¸¦å›æ”¶ç‡Ÿé¤Š", "ä¿è­·å…¶ä»–ç”Ÿç‰©"],
                    correct: 2,
                    explanation: "åˆ†è§£è€…å°‡æ­»äº¡çš„ç”Ÿç‰©åˆ†è§£ï¼Œå°‡ç‡Ÿé¤Šç‰©è³ªå›æ”¶åˆ°åœŸå£¤ä¸­ï¼Œè®“æ¤ç‰©èƒ½å¤ é‡æ–°åˆ©ç”¨ã€‚"
                },
                {
                    question: "å¦‚æœæ²’æœ‰åˆ†è§£è€…ï¼Œç”Ÿæ…‹ç³»çµ±æœƒç™¼ç”Ÿä»€éº¼ï¼Ÿ",
                    answers: ["æ›´åŠ ç¹æ¦®", "ç‡Ÿé¤Šå¾ªç’°ä¸­æ–·", "é£Ÿç‰©éˆè®Šé•·", "æº«åº¦ä¸Šå‡"],
                    correct: 1,
                    explanation: "æ²’æœ‰åˆ†è§£è€…ï¼Œæ­»äº¡ç”Ÿç‰©ç„¡æ³•åˆ†è§£ï¼Œç‡Ÿé¤Šç‰©è³ªç„¡æ³•å›æ”¶ï¼Œç”Ÿæ…‹ç³»çµ±çš„ç‡Ÿé¤Šå¾ªç’°æœƒä¸­æ–·ã€‚"
                }
            ]
        };

        // é£Ÿç‰©éˆéŠæˆ²æ•¸æ“š
        const foodChainData = {
            forest: [
                { id: 'grass', emoji: 'ğŸŒ±', name: 'è‰', level: 1, type: 'producer' },
                { id: 'rabbit', emoji: 'ğŸ°', name: 'å…”å­', level: 2, type: 'herbivore' },
                { id: 'fox', emoji: 'ğŸ¦Š', name: 'ç‹ç‹¸', level: 3, type: 'carnivore' },
                { id: 'eagle', emoji: 'ğŸ¦…', name: 'è€é·¹', level: 4, type: 'carnivore' }
            ],
            ocean: [
                { id: 'algae', emoji: 'ğŸŸ¢', name: 'è—»é¡', level: 1, type: 'producer' },
                { id: 'small_fish', emoji: 'ğŸŸ', name: 'å°é­š', level: 2, type: 'herbivore' },
                { id: 'big_fish', emoji: 'ğŸ ', name: 'å¤§é­š', level: 3, type: 'carnivore' },
                { id: 'shark', emoji: 'ğŸ¦ˆ', name: 'é¯Šé­š', level: 4, type: 'carnivore' }
            ]
        };

        // å¯¦é©—æ•¸æ“š
        const experimentData = {
            temperature: 0,  // -2 åˆ° +2
            rainfall: 0,     // -2 åˆ° +2
            pollution: 0,    // 0 åˆ° +3
            basePop: {
                plants: 60,
                herbivores: 40,
                carnivores: 30
            }
        };

        // éŸ³æ•ˆç³»çµ±
        const audioSystem = {
            musicEnabled: true,
            soundEnabled: true,
            currentMusic: null,
            
            // ä½¿ç”¨ Web Audio API ç”ŸæˆéŸ³æ•ˆ
            audioContext: null,
            
            init() {
                // å‰µå»º AudioContext
                this.audioContext = new (window.AudioContext || window.webkitAudioContext)();
                
                // é–‹å§‹èƒŒæ™¯éŸ³æ¨‚
                this.startBackgroundMusic();
            },
            
            // æ’­æ”¾éŸ³æ•ˆ
            playTone(frequency, duration, type = 'sine') {
                if (!this.soundEnabled || !this.audioContext) return;
                
                const oscillator = this.audioContext.createOscillator();
                const gainNode = this.audioContext.createGain();
                
                oscillator.connect(gainNode);
                gainNode.connect(this.audioContext.destination);
                
                oscillator.frequency.value = frequency;
                oscillator.type = type;
                
                gainNode.gain.setValueAtTime(0.1, this.audioContext.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, this.audioContext.currentTime + duration);
                
                oscillator.start(this.audioContext.currentTime);
                oscillator.stop(this.audioContext.currentTime + duration);
            },
            
            // æ’­æ”¾å’Œå¼¦
            playChord(frequencies, duration) {
                if (!this.soundEnabled || !this.audioContext) return;
                
                frequencies.forEach(freq => {
                    this.playTone(freq, duration);
                });
            },
            
            // èƒŒæ™¯éŸ³æ¨‚ï¼ˆç°¡å–®çš„æ—‹å¾‹å¾ªç’°ï¼‰
            startBackgroundMusic() {
                if (!this.musicEnabled || !this.audioContext) return;
                
                const playMelody = () => {
                    const melody = [
                        { freq: 523.25, duration: 0.5 }, // C5
                        { freq: 587.33, duration: 0.5 }, // D5
                        { freq: 659.25, duration: 0.5 }, // E5
                        { freq: 698.46, duration: 0.5 }, // F5
                        { freq: 783.99, duration: 1.0 }, // G5
                        { freq: 659.25, duration: 0.5 }, // E5
                        { freq: 523.25, duration: 1.0 }, // C5
                    ];
                    
                    let currentTime = this.audioContext.currentTime;
                    
                    melody.forEach(note => {
                        if (this.musicEnabled) {
                            this.playTone(note.freq, note.duration, 'triangle');
                        }
                        currentTime += note.duration;
                    });
                };
                
                // æ¯10ç§’æ’­æ”¾ä¸€æ¬¡æ—‹å¾‹
                const musicInterval = setInterval(() => {
                    if (this.musicEnabled) {
                        playMelody();
                    }
                }, 10000);
                
                // ç«‹å³æ’­æ”¾ä¸€æ¬¡
                playMelody();
            }
        };

        // æ’­æ”¾ç‰¹å®šéŸ³æ•ˆ
        function playSound(type) {
            if (!audioSystem.soundEnabled || !audioSystem.audioContext) return;
            
            switch(type) {
                case 'discover':
                    // ç™¼ç¾éŸ³æ•ˆï¼šä¸Šå‡çš„ä¸‰éŸ³
                    audioSystem.playTone(440, 0.1);
                    setTimeout(() => audioSystem.playTone(554, 0.1), 100);
                    setTimeout(() => audioSystem.playTone(659, 0.2), 200);
                    break;
                    
                case 'correct':
                    // æ­£ç¢ºéŸ³æ•ˆï¼šæ„‰å¿«çš„å’Œå¼¦
                    audioSystem.playChord([523.25, 659.25, 783.99], 0.5);
                    break;
                    
                case 'wrong':
                    // éŒ¯èª¤éŸ³æ•ˆï¼šä½æ²‰çš„å–®éŸ³
                    audioSystem.playTone(220, 0.3, 'sawtooth');
                    break;
                    
                case 'achievement':
                    // æˆå°±éŸ³æ•ˆï¼šè¯éº—çš„éŸ³éš
                    [523, 587, 659, 698, 784, 880, 988, 1047].forEach((freq, i) => {
                        setTimeout(() => audioSystem.playTone(freq, 0.2), i * 100);
                    });
                    break;
                    
                case 'button':
                    // æŒ‰éˆ•éŸ³æ•ˆï¼šçŸ­ä¿ƒçš„é»æ“Šè²
                    audioSystem.playTone(800, 0.1);
                    break;
            }
        }

        // åˆ‡æ›éŸ³æ¨‚
        function toggleMusic() {
            audioSystem.musicEnabled = !audioSystem.musicEnabled;
            const btn = document.getElementById('music-btn');
            
            if (audioSystem.musicEnabled) {
                btn.textContent = 'ğŸµ';
                btn.classList.remove('muted');
                btn.title = 'èƒŒæ™¯éŸ³æ¨‚ï¼šé–‹å•Ÿ';
            } else {
                btn.textContent = 'ğŸ”‡';
                btn.classList.add('muted');
                btn.title = 'èƒŒæ™¯éŸ³æ¨‚ï¼šé—œé–‰';
            }
            
            playSound('button');
        }

        // åˆ‡æ›éŸ³æ•ˆ
        function toggleSound() {
            audioSystem.soundEnabled = !audioSystem.soundEnabled;
            const btn = document.getElementById('sound-btn');
            
            if (audioSystem.soundEnabled) {
                btn.textContent = 'ğŸ”Š';
                btn.classList.remove('muted');
                btn.title = 'éŸ³æ•ˆï¼šé–‹å•Ÿ';
            } else {
                btn.textContent = 'ğŸ”‡';
                btn.classList.add('muted');
                btn.title = 'éŸ³æ•ˆï¼šé—œé–‰';
            }
            
            playSound('button');
        }
            currentEnvironment: 'forest',
            currentMode: 'explore',
            score: 0,
            discoveredCount: 0,
            totalCreatures: 0,
            level: 'æ–°æ‰‹æ¢éšªå®¶',
            answeredQuestions: new Set(),
            currentQuestion: null,
            foodChainProgress: { level: 1, selected: [] },
            waitingForAnswer: false
        };

        // åˆå§‹åŒ–éŠæˆ²
        function initGame() {
            gameState.totalCreatures = Object.values(gameData).reduce((total, env) => total + env.creatures.length, 0);
            updateDisplay();
            loadEnvironment('forest');
            setupFoodChainGame();
            resetExperiment();
        }

        // åˆ‡æ›éŠæˆ²æ¨¡å¼
        function switchMode(mode) {
            document.querySelectorAll('.mode-btn').forEach(btn => btn.classList.remove('active'));
            document.querySelectorAll('.game-mode').forEach(mode => mode.classList.remove('active'));
            
            event.target.classList.add('active');
            document.getElementById(mode + '-mode').classList.add('active');
            
            gameState.currentMode = mode;
            
            if (mode === 'foodchain') {
                loadFoodChainGame();
            }
            
            playSound('button');
        }

        // é¸æ“‡ç’°å¢ƒ
        function selectEnvironment(envId) {
            if (gameState.waitingForAnswer) {
                alert('è«‹å…ˆå›ç­”ç•¶å‰å•é¡Œæ‰èƒ½åˆ‡æ›ç’°å¢ƒï¼');
                return;
            }
            
            document.querySelectorAll('.env-button').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            
            loadEnvironment(envId);
            gameState.currentEnvironment = envId;
            playSound('button');
        }

        // è¼‰å…¥ç’°å¢ƒ
        function loadEnvironment(envId) {
            const env = gameData[envId];
            document.getElementById('current-env').textContent = env.name;
            
            const grid = document.getElementById('creature-grid');
            grid.innerHTML = '';
            
            env.creatures.forEach((creature, index) => {
                const card = document.createElement('div');
                const isLocked = index > 0 && !env.creatures[index - 1].discovered;
                
                card.className = `creature-card ${creature.discovered ? 'discovered' : ''} ${isLocked ? 'locked' : ''}`;
                card.innerHTML = `
                    ${isLocked ? '<div class="lock-icon">ğŸ”’</div>' : ''}
                    <span class="creature-emoji">${creature.emoji}</span>
                    <div class="creature-name">${creature.name}</div>
                    <div class="creature-role">${creature.role}</div>
                `;
                
                if (!isLocked) {
                    card.onclick = () => discoverCreature(envId, creature.id);
                }
                
                grid.appendChild(card);
            });
        }

        // ç™¼ç¾ç”Ÿç‰©
        function discoverCreature(envId, creatureId) {
            if (gameState.waitingForAnswer) {
                alert('è«‹å…ˆå›ç­”ç•¶å‰å•é¡Œï¼');
                return;
            }
            
            const creature = gameData[envId].creatures.find(c => c.id === creatureId);
            
            if (!creature.discovered) {
                creature.discovered = true;
                gameState.discoveredCount++;
                gameState.score += 10;
                
                // æ’­æ”¾ç™¼ç¾éŸ³æ•ˆ
                playSound('discover');
                
                showQuestion(creature);
                gameState.waitingForAnswer = true;
                
                updateDisplay();
                loadEnvironment(envId);
                checkAchievements();
            } else {
                // å¦‚æœå·²ç¶“ç™¼ç¾ï¼Œé‡æ–°é¡¯ç¤ºå•é¡Œ
                showQuestion(creature);
                gameState.waitingForAnswer = true;
            }
        }

        // é¡¯ç¤ºå•é¡Œ
        function showQuestion(creature) {
            const questionPanel = document.getElementById('question-panel');
            const questionTitle = document.getElementById('question-title');
            const questionContent = document.getElementById('question-content');
            const answersDiv = document.getElementById('answers');
            const feedbackDiv = document.getElementById('feedback');
            
            const questionType = creature.questions || 'producer';
            const questionList = questions[questionType];
            const questionData = questionList[Math.floor(Math.random() * questionList.length)];
            
            gameState.currentQuestion = questionData;
            
            questionTitle.textContent = `ğŸ¯ é—œæ–¼ ${creature.name} çš„å•é¡Œ`;
            questionContent.innerHTML = `<p>${questionData.question}</p>`;
            
            answersDiv.innerHTML = '';
            feedbackDiv.innerHTML = '';
            
            questionData.answers.forEach((answer, index) => {
                const btn = document.createElement('button');
                btn.className = 'answer-btn';
                btn.textContent = answer;
                btn.onclick = () => checkAnswer(index, questionData.correct, questionData.explanation);
                answersDiv.appendChild(btn);
            });
            
            questionPanel.classList.add('active');
        }

        // æª¢æŸ¥ç­”æ¡ˆ
        function checkAnswer(selectedIndex, correctIndex, explanation) {
            const buttons = document.querySelectorAll('.answer-btn');
            const feedbackDiv = document.getElementById('feedback');
            
            buttons.forEach((btn, index) => {
                btn.onclick = null;
                if (index === correctIndex) {
                    btn.classList.add('correct');
                } else if (index === selectedIndex) {
                    btn.classList.add('wrong');
                }
            });
            
            if (selectedIndex === correctIndex) {
                gameState.score += 20;
                feedbackDiv.innerHTML = `<p>âœ… ç­”å°äº†ï¼${explanation}</p>`;
                playSound('correct');
            } else {
                feedbackDiv.innerHTML = `<p>âŒ ç­”éŒ¯äº†ï¼æ­£ç¢ºç­”æ¡ˆæ˜¯ï¼š${buttons[correctIndex].textContent}<br>${explanation}</p>`;
                playSound('wrong');
            }
            
            gameState.waitingForAnswer = false;
            updateDisplay();
            
            setTimeout(() => {
                document.getElementById('question-panel').classList.remove('active');
            }, 3000);
        }

        // è¨­ç½®é£Ÿç‰©éˆéŠæˆ²
        function setupFoodChainGame() {
            const optionsDiv = document.getElementById('chain-options');
            const currentChain = foodChainData.forest;
            
            optionsDiv.innerHTML = '<h4>é¸æ“‡åˆé©çš„ç”Ÿç‰©ï¼š</h4>';
            
            currentChain.slice(1).forEach(creature => {
                const option = document.createElement('div');
                option.className = 'chain-item';
                option.innerHTML = `
                    <div class="creature-emoji">${creature.emoji}</div>
                    <div>${creature.name}</div>
                `;
                option.onclick = () => selectForChain(creature);
                optionsDiv.appendChild(option);
            });
        }

        // è¼‰å…¥é£Ÿç‰©éˆéŠæˆ²
        function loadFoodChainGame() {
            resetFoodChain();
            setupFoodChainGame();
        }

        // é¸æ“‡é£Ÿç‰©éˆç”Ÿç‰©
        function selectForChain(creature) {
            const currentLevel = gameState.foodChainProgress.level;
            if (currentLevel > 4) return;
            
            const slot = document.getElementById(`chain-slot-${currentLevel + 1}`);
            if (slot) {
                slot.innerHTML = `
                    <div class="creature-emoji">${creature.emoji}</div>
                    <div>${creature.name}</div>
                `;
                slot.dataset.creatureId = creature.id;
                gameState.foodChainProgress.selected.push(creature);
                gameState.foodChainProgress.level++;
            }
        }

        // æª¢æŸ¥é£Ÿç‰©éˆç­”æ¡ˆ
        function checkFoodChain() {
            const correctChain = foodChainData.forest.slice(1);
            const userChain = gameState.foodChainProgress.selected;
            
            let isCorrect = true;
            for (let i = 0; i < userChain.length; i++) {
                const slot = document.getElementById(`chain-slot-${i + 2}`);
                if (userChain[i].id === correctChain[i].id) {
                    slot.classList.add('correct');
                } else {
                    slot.classList.add('wrong');
                    isCorrect = false;
                }
            }
            
            if (isCorrect && userChain.length === correctChain.length) {
                gameState.score += 50;
                updateDisplay();
                showAchievement('ğŸ‰ é£Ÿç‰©éˆå»ºç«‹æ­£ç¢ºï¼ä½ æ˜¯ç”Ÿæ…‹å°ˆå®¶ï¼');
                playSound('achievement');
            } else {
                showAchievement('ğŸ¤” é£Ÿç‰©éˆä¸å¤ªå°ï¼Œå†è©¦è©¦çœ‹ï¼');
                playSound('wrong');
            }
        }

        // é‡ç½®é£Ÿç‰©éˆ
        function resetFoodChain() {
            gameState.foodChainProgress = { level: 1, selected: [] };
            
            for (let i = 2; i <= 4; i++) {
                const slot = document.getElementById(`chain-slot-${i}`);
                slot.innerHTML = '<div>é»æ“Šé¸æ“‡</div>';
                slot.className = 'chain-item';
                slot.dataset.creatureId = '';
            }
        }

        // èª¿æ•´å¯¦é©—ç’°å¢ƒ
        function adjustEnvironment(factor, change) {
            switch (factor) {
                case 'temperature':
                    experimentData.temperature = Math.max(-2, Math.min(2, experimentData.temperature + change));
                    break;
                case 'rainfall':
                    experimentData.rainfall = Math.max(-2, Math.min(2, experimentData.rainfall + change));
                    break;
                case 'pollution':
                    experimentData.pollution = Math.max(0, Math.min(3, experimentData.pollution + change));
                    break;
            }
            updateExperimentDisplay();
        }

        // æ›´æ–°å¯¦é©—é¡¯ç¤º
        function updateExperimentDisplay() {
            const tempLabels = ['æ¥µå†·', 'å¾ˆå†·', 'é©ä¸­', 'å¾ˆç†±', 'æ¥µç†±'];
            const rainLabels = ['ä¹¾æ—±', 'å°‘é›¨', 'é©ä¸­', 'å¤šé›¨', 'æ´ªæ°´'];
            const pollutionLabels = ['ä½', 'ä¸­', 'é«˜', 'æ¥µé«˜'];
            
            document.getElementById('temperature').textContent = tempLabels[experimentData.temperature + 2];
            document.getElementById('rainfall').textContent = rainLabels[experimentData.rainfall + 2];
            document.getElementById('pollution').textContent = pollutionLabels[experimentData.pollution];
            
            // è¨ˆç®—ç¨®ç¾¤è®ŠåŒ–
            const tempEffect = 1 - Math.abs(experimentData.temperature) * 0.2;
            const rainEffect = 1 - Math.abs(experimentData.rainfall) * 0.15;
            const pollutionEffect = 1 - experimentData.pollution * 0.25;
            
            const plantPop = experimentData.basePop.plants * tempEffect * rainEffect * pollutionEffect;
            const herbivorePop = experimentData.basePop.herbivores * (plantPop / experimentData.basePop.plants) * pollutionEffect;
            const carnivorePop = experimentData.basePop.carnivores * (herbivorePop / experimentData.basePop.herbivores) * pollutionEffect;
            
            document.getElementById('plant-bar').style.height = Math.max(10, plantPop) + 'px';
            document.getElementById('herbivore-bar').style.height = Math.max(5, herbivorePop) + 'px';
            document.getElementById('carnivore-bar').style.height = Math.max(5, carnivorePop) + 'px';
        }

        // é‡ç½®å¯¦é©—
        function resetExperiment() {
            experimentData.temperature = 0;
            experimentData.rainfall = 0;
            experimentData.pollution = 0;
            updateExperimentDisplay();
        }

        // æª¢æŸ¥æˆå°±
        function checkAchievements() {
            const achievement = document.getElementById('achievement');
            let showAchievement = false;
            let achievementText = '';
            
            if (gameState.discoveredCount === 5 && gameState.level === 'æ–°æ‰‹æ¢éšªå®¶') {
                gameState.level = 'ç”Ÿæ…‹å­¸å¾’';
                achievementText = 'ğŸ‰ æ­å–œå‡ç´šç‚ºç”Ÿæ…‹å­¸å¾’ï¼';
                showAchievement = true;
            } else if (gameState.discoveredCount === 15 && gameState.level === 'ç”Ÿæ…‹å­¸å¾’') {
                gameState.level = 'ç’°å¢ƒå°ˆå®¶';
                achievementText = 'ğŸ† æ­å–œå‡ç´šç‚ºç’°å¢ƒå°ˆå®¶ï¼';
                showAchievement = true;
            } else if (gameState.discoveredCount === 30 && gameState.level === 'ç’°å¢ƒå°ˆå®¶') {
                gameState.level = 'ç”Ÿæ…‹å¤§å¸«';
                achievementText = 'ğŸŒŸ æ­å–œæˆç‚ºç”Ÿæ…‹å¤§å¸«ï¼';
                showAchievement = true;
            } else if (gameState.discoveredCount === gameState.totalCreatures) {
                achievementText = 'ğŸŠ å¤ªæ£’äº†ï¼ä½ ç™¼ç¾äº†æ‰€æœ‰ç”Ÿç‰©ï¼ä½ æ˜¯çœŸæ­£çš„ç”Ÿæ…‹æ¢éšªå®¶ï¼';
                showAchievement = true;
            }
            
            if (showAchievement) {
                this.showAchievement(achievementText);
                playSound('achievement');
            }
        }

        // é¡¯ç¤ºæˆå°±
        function showAchievement(text) {
            const achievement = document.getElementById('achievement');
            achievement.textContent = text;
            achievement.classList.remove('hidden');
            setTimeout(() => {
                achievement.classList.add('hidden');
            }, 4000);
        }

        // æ›´æ–°é¡¯ç¤º
        function updateDisplay() {
            document.getElementById('discovered-count').textContent = gameState.discoveredCount;
            document.getElementById('score').textContent = gameState.score;
            document.getElementById('level').textContent = gameState.level;
            
            const progress = (gameState.discoveredCount / gameState.totalCreatures) * 100;
            document.getElementById('progress-fill').style.width = progress + '%';
        }

        // å•Ÿå‹•éŠæˆ²
        initGame();
    </script>
</body>
</html>
